<!DOCTYPE html>
<html>
<head>
    <title>ë¯¸ì„¸ë¨¼ì§€ ìƒíƒœ ì¡°íšŒ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            font-size: 12px;
            text-align: center;
            margin-top: 0px;
        }
        #result {
            max-width: 400px;
            margin: 0 auto;
            padding: 1px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h3 {
            color: #1a535c;
            font-size: 16px;
            margin-bottom: 10px;
        }
        p {
            color: #000;
            margin-bottom: 5px;
        }
        .emoji {
            color: #1a535c;
            font-size: 24px;
        }
    </style>
</head>
<body>

<div id="result"></div>

<script>
    // ì„œë²„ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
    async function getApiKey() {
        try {
            const response = await fetch('/api/get-key');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            return data.apiKey;
        } catch (error) {
            console.error('API í‚¤ ë¡œë“œ ì‹¤íŒ¨:', error);
            return null;
        }
    }

    async function getData() {
        const apiKey = await getApiKey();
        if (!apiKey) {
            document.getElementById('result').innerText = 'API í‚¤ ë¡œë“œ ì‹¤íŒ¨';
            return;
        }

        const url = `https://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?sidoName=ìš¸ì‚°&pageNo=1&numOfRows=100&returnType=json&serviceKey=${apiKey}&ver=1.0`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            let stationName;
            let pm25Value;
            let dataTime;
            let pm25Imojji;

            if (data && data.response && data.response.body && data.response.body.items) {
                const airQualityData = data.response.body.items;
                airQualityData.forEach(item => {
                    if (item.stationName === 'ì‚¼ë‚¨ì') {
                        stationName = item.stationName;
                        pm25Grade = item.pm25Grade;
                        pm25Value = item.pm25Value;
                        dataTime = item.dataTime;

                        if (pm25Grade == 1) {
                            pm25Imojji = "ğŸ˜Šì¢‹ìŒğŸ˜Š";
                        } else if (pm25Grade == 2) {
                            pm25Imojji = "ğŸ˜ë³´í†µğŸ˜";
                        } else if (pm25Grade == 3) {
                            pm25Imojji = "ğŸ˜·ë‚˜ì¨ğŸ˜·";
                        } else {
                            pm25Imojji = "â“ì •ë³´ ì—†ìŒ";
                        }
                    }
                });

                document.getElementById('result').innerHTML = `
                    <h3>ìš°ë¦¬í•™êµ ë¯¸ì„¸ë¨¼ì§€</h3>
                    <p><span class="emoji">${pm25Imojji}</span><br>
                    ì¸¡ì • ì¥ì†Œ: ${stationName}<br>
                    ì¸¡ì • ì‹œê°„: ${dataTime}<br>
                    ë¯¸ì„¸ë¨¼ì§€ ë†ë„: ${pm25Value}</p>
                `;
            } else {
                document.getElementById('result').innerText = 'ë°ì´í„° ì—†ìŒ';
            }
        } catch (error) {
            console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
            document.getElementById('result').innerText = 'ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨';
        }
    }

    window.onload = getData;
</script>

</body>
</html>
